---
title: "Computer Animation and Special Effects"
output:
 html_document:
   toc: true
   toc_depth: 4
   toc_float:
    collapsed: false
    smooth_scroll: false

---

<style type="text/css">

body{ /* Normal  */
      font-size: 18px;
  }
td {  /* Table  */
  
}
h1.title {
  font-size: 40px;
  color: DarkRed;
}
h1 { /* Header 1 */
  font-size: 35px;
  color: DarkBlue;
}
h2 { /* Header 2 */
    font-size: 30px;
  color: DarkBlue;
}
h3 { /* Header 3 */
  font-size: 25px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
}
h4 {
	font-size: 23px;
	color: Blue;
}
h5 {
	font-size: 20px;
	color: DarkGreen;
}
code.r{ /* Code block */
    font-size: 13px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 13px;
}

.thumbnail:hover {
    position:relative;
    width:1000px;
    height:auto;
    display:block;
    z-index:999;
}

</style>


## Course Informations
* No textbook
* Grading Schemes:
	* Assignment 1 (25%): Particle System
	* Assignment 2 (25%): Character Animation
	* Assignment 3 (20%): Paper Presentation or Case study on special effects
	* Final Projects (30%)
		* 2 students/team
 
## Course Overview
* Physics/Math background
	* 3D rotations
	* Rigid-body dynamics
	* Solving ordinary differential equation
	* Optimization
* Character Animation
	* Keyframing
	* Motion Capture
	* Motion Editing
* Physics-based animation
	* Cloth simulation
	* Fluid simulation
	* Biped simulation
	* Hair simulation
* Behavior Animation
	* Flocking behavior
	* Crowds simulation
 
## Introduction
 
##### Kinematics
* The study or specification of motion, independent of the underlying physics that created the motion.
* Articulated Figure: A figure made up of a series of links (bones) connected at joints.
* Forward Kinematics: Given the character's state, calculate its pose
	<img src="https://i.imgur.com/gkZTxqo.png" width="500" /> 
* Inverse Kinematice: Given the character's pose, calculate its state
	<img src="https://i.imgur.com/HlSqOsN.png" width="500" />
 
##### Motion Capture
* Live action recording
* track motion of reference points
* convert to joint angles to drive an articulated 3D model
* drive a deformable surface
 
##### Motion Editing
* Get a specific motion
* Want something else while preserving original
 
 

## Ordinary Differential Equations
##### Differential Equations
* describes the **relation between an unknown function and its derivatives**
* solving a differential equation is to **find a function that satisfies the relation**
 
##### First-Ordinary Differential Equation (ODE)
* All derivatives are with respect to a single independent **variable**, usually representing **time**
	<img src="https://i.imgur.com/u7QQ6BI.jpg" style="width: 200px;"/>
* Higher ODE can be transformed into this 1st order system.
 
##### Higher-Order ODEs
<img src="https://i.imgur.com/SnWOCNG.png" width="500" />
<img src="https://i.imgur.com/Tc9JErV.png" width="500" />
 
##### Visualizing Solution of ODE
* x(t): a moving point
* f(x,t): x's velocities
 
##### Vector Field
* The differential equation x` = f(x,t), defines a vector field over x.
 
##### Initial Value Problem
* Given x` = f(x,t) and x0 = x(t0), find x(t).
* Given the starting point, follow the integral curve.
 
##### Numerical Solution of ODEs
* Follow a polygonal path
* By evaluating the derivative at discrete time steps
* Bigger steps, bigger errors
<img src="https://i.imgur.com/GXc0wTW.png" style="width: 260px;"/>
 
##### Euler's Method
* Simplest numerical solution method
* Bigger time step, bigger errors
* x(t+h) = x(t) + h * f(x,t)
<img src="https://i.imgur.com/akW0SZR.png" width="500" />
* Drawbacks of Duler's Method
	* Inaccurancy
	* Inefficiency
		* Need to use small time-steps to **avoid divergence**
* Improvement using **midpoint method**: **slope** at midtime is used
 
##### The Midpoint Method
* Accuracy of the Midpoint Method is O(h^3)
<img src="https://i.imgur.com/Zpz3L4S.png" width="500" />

##### Notes
* Don't use Euler's method
	* Inaccuracy
	* Inefficiency (or unstable)
 
##### Stability of Analytic Solution of ODE
* Stable: if solutions resulting from perturbations of initial value **remain close** to original solution.
* Unstable: if solutions diverges away from original solution without bound.
* Neutrally Stable: if solutions are neither stable nor unstable
* Simple Approach to determining **stability** and **accuracy** of numerical method:
	* Apply it to scalar ODE **x`= Ax**, where A is constant. 
	* Example:
		<img src="https://i.imgur.com/KTEb3wj.png.jpg" width="500" />
      
##### Propagated Error
* Error made early in the process will also affect the late computations ---- the early error will be propagated
* Global error is the sum of propageted error and local error

## Stiff Equations
* Consider s simple ODE x` = -kx (Dampler System), k is a stiffness constant
* Spring Force: Fs = -ks * x
* Damping Force: reduce the amplitiude of oscillation
	* Fd = -c * v
	* ma = -c * v
	* v` = -(c/m) * v
* Step size of Euler's method is limited by k:
	<img src="https://i.imgur.com/FZPTBdq.png" width="500" />
* Systems that have some big k's mixed in are called **stiff equations**
* Remedy to stiff equations:
	* Using **small** step size -> inefficient
	* Implicit method
 
##### Implicit Method
* Euler's method is explicit: uses only information at tim t(n) to advance solution to time t(n+1)
* Larger stability region can be achieved using information at time t(n+1) -> **Implicit**
	* x(n+1) = x(n) + h * f(x(n+1), t(n+1))
* We must evaluate f with x(n+1) before we know its value.

## Particle System
* Particles are objects modeled as point masses
* Particle properties:
	* mass
	* position
	* velocity
	* force accumulator
	* age, lifespan
	* rendering properties
* x` = v
* v` = f/m
* x`` = f/m
 
##### Spatial Forces
* Forces that depend on nearby particles within a local region

##### Unary Forces
* Forces that only depend on 1 particle

##### n-ary Forces
* Forces that depend on n particles
* binary forces: spring and damper

##### Spring Force (彈力)
<img src="https://i.imgur.com/HsJ2ul3.png" width="500" />

##### Damper Force (阻尼力)
<img src="https://i.imgur.com/9AnGxka.png" width="500" />

### Collision Detection and Response (For now, just simple point-plane collisions)
<img src="https://i.imgur.com/8jP2KnG.png" width="500" />

### Collision Response
* A less accurate but easier alternative is to just modify **positions** and **velocities**
<img src="https://i.imgur.com/XzcvXXZ.png" width="500" />

## Constraint Particles
### Constraint Force
#### Single implicit constraint
* Constraints:
	* Implicit: C(x) = |x| - r = 0
	* Parametric
		<img src="https://i.imgur.com/ZvkRpIB.png" style="width: 400px;"/>
* Legal Acceleration
<img src="https://i.imgur.com/ZuXePKq.png" width="500" />
* Constraint Force
	* Use the legal condition to compute the constraint force: f^
	<img src="https://i.imgur.com/gON4vGf.png" width="500" />
	* We have one equation and two variables -> need more condition to solve the constraint force
  
##### Virtual Work (虛功)
* Constraint force is passive (no energy gain or loss)
* Kinetic energy (動能) of the system: T = 1/2 * m * x`·x`
	* T` = 1/2 * m (x``·x`+x`·x``) = m * x`·x`` = x(f + f^) -> **f and f^ 所作的虛功**
	<img src="https://i.imgur.com/VRdOOIV.png" width="500" />
		* 因為是光滑面，所以系統對物體作功為0
		* 故只有正向力，且正向力與x垂直
* Constraint Force:
<img src="https://i.imgur.com/5fs82uT.png" style="width: 300px;"/>
	* If the system is at rest: v = 0
		* Only the tangent component of the applied force is kept
		<img src="https://i.imgur.com/RCp7FfD.png" style="width: 180px;"/>

#### Multiple implicit constraint
* Apply the idea of a bead on a wire on a constrained particle system
* Particles: each particle represents a point in the phase space
* Forces: each force affects the acceleration of certain particles
* Constraints:
	* Each is a function Ci(x1, x2, x3, ...)
	* Legal state: Ci(x1, x2, x3, ...) = 0, for all i
	* Constraint Force: linear combination of constraint gradients: <img src="https://i.imgur.com/NKeASoo.png" style="width: 100px;" />	
	<img src="https://i.imgur.com/2A2XsaI.png" style="width: 550px;" />
1. system of constraint equation **C(q) = 0**
<img src="https://i.imgur.com/NiFKSJk.png" style="width: 700px;" />
2. To compute the **legal acceleration**:
<img src="https://i.imgur.com/f3j8QoR.png" style="width: 700px;" />
3. To ensure the constraint force does not produce Work
<img src="https://i.imgur.com/5uR4jD8.png" style="width: 700px;" />
4. All vectors satisfy the condition can be expressed as:
<img src="https://i.imgur.com/7xWsTGZ.png" style="width: 700px;" />
5. Constraint forces obtained by solving the linear system
<img src="https://i.imgur.com/5ab7Fgw.png" style="width: 700px;" />

* Constraint Gradients:
<img src="https://i.imgur.com/STP3Srr.png" style="width: 400px;" />
	* Legal states: the intersection of two planes
	* Normal of legal states:
	<img src="https://i.imgur.com/oMOFITT.png" style="width: 400px;" />
	* Constraint forces are aligned with the normal of legal states
	* Work done by constraint forces is **zero**

### Parametric contraint